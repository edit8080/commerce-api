# Bean Bliss E-commerce API - Product Requirements Document (PRD)

## 📋 문서 정보
- **프로젝트명**: Bean Bliss 커피 원두 전문 쇼핑몰 API
- **작성일**: 2025-11-02
- **버전**: 1.0
- **상태**: DONE

---

## 1. 프로젝트 개요

### 1.1 목적
Bean Bliss는 커피 원두 전문 온라인 쇼핑몰로, 고객에게 다양한 원두 상품을 제공하고 편리한 구매 경험을 제공하는 것을 목표로 합니다. 본 API는 상품 관리, 재고 관리, 주문/결제, 쿠폰, 배송 관리 등 전자상거래의 핵심 기능을 제공합니다.

### 1.2 비즈니스 목표
- 커피 원두 상품의 효율적인 온라인 판매 시스템 구축
- 실시간 재고 관리를 통한 재고 부족 문제 최소화
- 옵션별 상품 관리를 통한 다양한 고객 니즈 충족
- 쿠폰 및 프로모션을 통한 고객 유입 및 재구매 유도
- 원활한 주문 프로세스 제공

### 1.3 핵심 가치
- **정확한 재고 관리**: 옵션별 실시간 재고 추적
- **빠른 결제 프로세스**: 잔액 기반 간편 결제
- **투명한 배송 추적**: 주문 상태별 실시간 배송 현황 확인
- **프로모션 최적화**: 선착순 쿠폰을 통한 마케팅 효과 극대화

---

## 2. 이해관계자 및 사용자

### 2.1 등장인물
| 역할 | 이름 | 설명 |
|-----|------|------|
| 고객 | 김지수 | 새로운 커피 원두를 탐색하고 구매하는 것을 즐기는 커피 애호가 |
| 관리자 | 박사장 | Bean Bliss 온라인 쇼핑몰의 운영자. 상품 관리 및 판매 데이터 확인 담당 |
| 시스템 | - | 자동화된 비즈니스 로직 처리 (재고 차감, 쿠폰 검증 등) |

### 2.2 사용자 페르소나

#### 페르소나 1: 김지수 (고객)
- **연령**: 30대 초반
- **직업**: 회사원
- **특징**: 커피 애호가, 온라인 쇼핑 선호
- **니즈**:
  - 인기 있는 원두 상품을 빠르게 찾고 싶음
  - 분쇄도와 용량을 자유롭게 선택하고 싶음
  - 할인 쿠폰을 활용하여 합리적인 가격에 구매하고 싶음
  - 주문 상태를 실시간으로 확인하고 싶음

#### 페르소나 2: 박사장 (관리자)
- **역할**: 쇼핑몰 운영자
- **특징**: 효율적인 재고 관리와 주문 처리를 중요시함
- **니즈**:
  - 재고가 부족한 상품을 빠르게 파악하고 보충하고 싶음
  - 신규 주문을 신속하게 확인하고 처리하고 싶음
  - 주문 상태를 단계별로 관리하고 싶음

---

## 3. 비즈니스 시나리오

### 3.1 시나리오 1: 고객의 상품 탐색 및 옵션 선택

**스토리**:
1. 고객 '김지수'는 Bean Bliss 사이트에 접속하여 메인 페이지의 **'최근 3일간 가장 많이 팔린 원두 Top 5'**를 통해 '에티오피아 예가체프 G1' 상품에 흥미를 느낀다.
2. 상품 상세 페이지로 이동하자, **'분쇄도'** (홀빈, 핸드드립)와 **'용량'** (200g, 500g) 옵션이 있는 것을 확인한다.
3. 김지수가 '핸드드립' 분쇄, '200g' 용량을 선택하자, 해당 옵션 조합의 정확한 **가격(21,000원)**과 **실시간 재고(8개)**가 표시된다.
4. 사이트를 둘러보던 중, **'오픈 기념! 선착순 100명 10% 할인 쿠폰'** 배너를 발견하고 클릭하여 쿠폰을 발급받는다.

**관련 기능**: PROD-001, PROD-002, PROD-003, CPN-001

### 3.2 시나리오 2: 주문 및 결제

**스토리**:
1. 김지수는 선택한 옵션('핸드드립' 분쇄, '200g') 그대로 상품을 **장바구니**에 담는다.
2. 주문을 배송받을 배송지를 입력한다.
3. 총 결제 금액을 확인하고, 발급받은 **10% 할인 쿠폰**을 적용한다.
4. 할인이 적용된 최종 금액을 확인하고, **미리 충전해 둔 잔액(예치금)으로 결제**를 진행한다.
5. 결제 시 남아있는 재고가 없거나 잔액이 부족하면, 결제가 실패한다.
6. 그렇지 않은 경우 결제가 완료된다.

**관련 기능**: CART-001, CART-002, ORD-001, ORD-002, ORD-003, ORD-004, ORD-005, CPN-002, CPN-003, CPN-004, USER-001, USER-003, INV-001

### 3.3 시나리오 3: 관리자 재고 관리

**스토리**:
1. 박사장은 재고 현황을 보다가 '에티오피아 예가체프 G1 - 핸드드립/200g'의 재고가 얼마 남지 않은 것을 확인한다.
2. 해당 **재고를 추가 입고** 처리한다.

**관련 기능**: INV-002, INV-003

### 3.4 시나리오 4: 주문 배송

#### 4.1 주문 확인 및 상품 준비
**스토리**:
1. 박사장은 관리자 페이지에 들어와 **'결제 완료' 상태**인 김지수의 신규 주문을 확인한다.
2. 주문서에는 '에티오피아 예가체프 G1, 200g, 핸드드립 분쇄'라고 명시되어 있다.
3. 박사장은 주문을 확인하고 **'상품 준비중'** 버튼을 누른다.
4. 박사장은 원두 상품을 포장하고, 배송 상자에 담아 송장을 출력한다.

**관련 기능**: ORD-008, ORD-007, SHIP-001

#### 4.2 배송 시작
**스토리**:
1. 오후 3시, 계약된 배송업체 기사님이 매장에 방문하여 준비된 상자를 수거해 간다.
2. 해당 주문을 **'배송 시작'으로 상태를 변경**하고, 배송업체로부터 받은 **운송장 번호 '1234567890'**을 입력한다.
3. 김지수는 이제 앱이나 웹사이트의 '주문 내역' 페이지에서 운송장 번호를 클릭하여 배송 현황을 실시간으로 조회할 수 있다.

**관련 기능**: SHIP-001, SHIP-002, ORD-006, ORD-007

#### 4.3 배송 완료
**스토리**:
1. 다음 날, 김지수는 집 앞에서 주문한 'Bean Bliss'의 커피 상자를 발견한다.
2. 잠시 후, 배송업체로부터 배송 완료 정보가 'Bean Bliss' 시스템에 연동된다.
3. 시스템은 자동으로 주문 상태를 **'배송 완료'로 변경**한다.

**관련 기능**: SHIP-001

---

## 4. 기능 요구사항

### 4.1 상품 관리

| 기능 ID | 기능명 | 설명 | 우선순위 | 담당 역할 |
|---------|--------|------|----------|-----------|
| PROD-001 | 인기 상품 Top K 조회 | 최근에 가장 많이 팔린 원두 상위 K개 조회 | High | 고객 |
| PROD-002 | 상품 상세 정보 조회 | 상품의 옵션(분쇄도, 용량) 정보 조회 | High | 고객 |
| PROD-003 | 옵션별 가격/재고 조회 | 선택한 옵션 조합의 실시간 가격 및 재고 수량 표시 | High | 고객 |

#### 세부 요구사항

**PROD-001: 인기 상품 Top K 조회**
- 최근 3일간의 판매 데이터를 기반으로 집계
- 상품별 판매량을 기준으로 내림차순 정렬
- K값은 설정 가능 (기본값: 5)
- 캐싱을 통한 성능 최적화 고려

**PROD-002: 상품 상세 정보 조회**
- 상품명, 설명, 이미지, 원산지 등 기본 정보
- 사용 가능한 옵션 목록 (분쇄도, 용량)
- 각 옵션별 가격 정보

**PROD-003: 옵션별 가격/재고 조회**
- 옵션 조합에 따른 실시간 재고 수량
- 재고 0개인 경우 "품절" 표시
- 옵션별 가격 차이 반영

---

### 4.2 재고 관리

| 기능 ID | 기능명 | 설명 | 우선순위 | 담당 역할 |
|---------|--------|------|----------|-----------|
| INV-001 | 재고 차감 | 주문 완료 시 해당 옵션의 재고 자동 차감 | Critical | 시스템 |
| INV-002 | 재고 현황 조회 | 옵션별 현재 재고 수량 조회 | High | 관리자 |
| INV-003 | 재고 추가 입고 | 특정 옵션의 재고 수량 증가 처리 | High | 관리자 |

#### 세부 요구사항

**INV-001: 재고 차감**
- 결제 완료 시점에 재고 차감 수행
- 동시성 제어를 통한 재고 부족 방지
- 재고 부족 시 적절한 예외 처리
- 트랜잭션 보장

**INV-002: 재고 현황 조회**
- 옵션별 재고 수량 조회

**INV-003: 재고 추가 입고**
- 특정 옵션 재고에 대한 입고 수량 입력

---

### 4.3 장바구니

| 기능 ID | 기능명 | 설명 | 우선순위 | 담당 역할 |
|---------|--------|------|----------|-----------|
| CART-001 | 장바구니 상품 추가 | 선택한 옵션의 상품을 장바구니에 추가 | High | 고객 |
| CART-002 | 장바구니 목록 조회 | 장바구니에 담긴 상품 목록 및 옵션 정보 조회 | High | 고객 |
| CART-003 | 장바구니 상품 삭제 | 장바구니에서 특정 상품 제거 | Medium | 고객 |
| CART-004 | 장바구니 상품 수량 수정 | 장바구니에서 특정 상품의 수량 변경 | Medium | 고객 |

#### 세부 요구사항

**CART-001: 장바구니 상품 추가**
- 상품 ID, 옵션 ID, 수량 정보 저장
- 동일 상품/옵션이 이미 있는 경우 수량 증가
- 재고 수량 초과 방지

**CART-002: 장바구니 목록 조회**
- 상품 정보, 옵션 정보, 수량, 가격 표시
- 품절된 상품 표시
- 총 금액 계산

**CART-003: 장바구니 상품 삭제**
- 특정 장바구니 아이템 삭제
- 소프트 삭제 고려

**CART-004: 장바구니 상품 수량 수정**
- 수량 증가/감소
- 최소 수량: 1개
- 재고 수량 초과 방지

---

### 4.4 쿠폰

| 기능 ID | 기능명 | 설명 | 우선순위 | 담당 역할 |
|---------|--------|------|----------|-----------|
| CPN-001 | 선착순 쿠폰 발급 | 수량 제한이 있는 쿠폰을 선착순으로 발급 | Critical | 고객 |
| CPN-002 | 쿠폰 유효성 검증 | 쿠폰 사용 가능 여부, 유효 기간, 사용 이력 확인 | Critical | 시스템 |
| CPN-003 | 쿠폰 할인 적용 | 결제 시 쿠폰 할인율 적용하여 최종 금액 계산 | High | 시스템 |
| CPN-004 | 쿠폰 상태 변경 | 쿠폰 발급, 사용 완료 등 상태 관리 | High | 시스템 |
| CPN-005 | 보유 쿠폰 목록 조회 | 사용자가 발급받은 쿠폰 목록 및 상태 확인 | Medium | 고객 |

#### 세부 요구사항

**CPN-001: 선착순 쿠폰 발급**
- 쿠폰 발급 수량 제한 (예: 100개)
- 동시성 제어를 통한 중복 발급 방지
- 1인당 발급 가능 개수 제한 (예: 1개)
- 발급 완료 시 쿠폰 코드 생성

**CPN-002: 쿠폰 유효성 검증**
- 쿠폰 존재 여부 확인
- 사용 여부 확인 (이미 사용된 쿠폰 사용 불가)
- 유효 기간 확인 (시작일 ~ 종료일)
- 최소 주문 금액 확인 (해당 시)

**CPN-003: 쿠폰 할인 적용**
- 할인 유형: 정률 할인 (예: 10%), 정액 할인 (예: 5,000원)
- 최대 할인 금액 제한 (해당 시)
- 할인 후 최종 결제 금액 계산

**CPN-004: 쿠폰 상태 변경**
- 상태: 발급됨(ISSUED), 사용됨(USED), 만료됨(EXPIRED)
- 사용 완료 시 사용 일시 기록

**CPN-005: 보유 쿠폰 목록 조회**
- 사용 가능한 쿠폰 우선 표시
- 만료 예정 쿠폰 알림
- 사용 완료/만료된 쿠폰 히스토리 제공

---

### 4.5 주문/결제

| 기능 ID | 기능명 | 설명 | 우선순위 | 담당 역할 |
|---------|--------|------|----------|-----------|
| ORD-001 | 주문 생성 | 장바구니 상품을 기반으로 주문 생성 | Critical | 고객 |
| ORD-002 | 배송지 입력 | 주문 시 배송받을 주소 정보 입력 | High | 고객 |
| ORD-003 | 잔액 결제 처리 | 사용자 예치금(잔액)을 이용한 결제 처리 | Critical | 고객 |
| ORD-004 | 결제 금액 계산 | 상품 금액에서 쿠폰 할인을 적용한 최종 결제 금액 산출 | Critical | 시스템 |
| ORD-005 | 결제 유효성 검증 | 재고/잔액/쿠폰 유효성 검증 | Critical | 시스템 |
| ORD-006 | 주문 목록 조회 | 사용자의 전체 주문 내역 조회 | High | 고객 |
| ORD-007 | 주문 상세 조회 | 특정 주문의 상세 정보 조회 | High | 고객, 관리자 |
| ORD-008 | 관리자 주문 목록 조회 | 전체 주문 내역 및 상태별 필터링 조회 | High | 관리자 |

#### 세부 요구사항

**ORD-001: 주문 생성**
- 장바구니 아이템을 기반으로 주문 생성
- 주문 번호 자동 생성 (예: ORD-20250102-001)
- 주문 시점의 상품 가격 저장

**ORD-002: 배송지 입력**
- 상품을 전달받을 배송지 입력

**ORD-003: 잔액 결제 처리**
- 사용자 잔액 확인
- 잔액 부족 시 결제 실패
- 결제 완료 시 잔액 차감
- 결제 트랜잭션 기록

**ORD-004: 결제 금액 계산**
- 상품 금액 합계 계산
- 쿠폰 할인 적용
- 배송비 계산 (해당 시)
- 최종 결제 금액 산출

**ORD-005: 결제 유효성 검증**
- 재고 충분 여부 확인
- 잔액 충분 여부 확인
- 쿠폰 유효성 검증
- 모든 검증 통과 시 결제 진행

**ORD-006: 주문 목록 조회**
- 사용자별 주문 내역 조회
- 주문 일시 기준 내림차순 정렬
- 페이지네이션 지원
- 주문 상태별 필터링

**ORD-007: 주문 상세 조회**
- 주문 정보 (주문번호, 주문일시, 주문상태)
- 상품 정보 (상품명, 옵션, 수량, 가격)
- 결제 정보 (결제 금액, 할인 금액, 쿠폰 정보)
- 배송 정보 (배송지, 운송장 번호)

**ORD-008: 관리자 주문 목록 조회**
- 전체 주문 내역 조회
- 주문 상태별 필터링 (결제완료, 상품준비중, 배송중, 배송완료)
- 주문 일자별 조회
- 검색 기능 (주문번호, 고객명)

---

### 4.6 배송 관리

| 기능 ID | 기능명 | 설명 | 우선순위 | 담당 역할 |
|---------|--------|------|----------|-----------|
| SHIP-001 | 주문 상태 변경 | 주문 상태를 단계별로 변경 | Critical | 관리자, 시스템 |
| SHIP-002 | 운송장 번호 등록 | 배송 시작 시 운송장 번호를 주문에 등록 | High | 관리자 |

#### 세부 요구사항

**SHIP-001: 주문 상태 변경**
- 상태 플로우: `결제완료` → `상품준비중` → `배송중` → `배송완료`
- 상태 변경 권한 제어 (관리자만 가능)
- 역방향 상태 변경 불가 (예: 배송중 → 상품준비중)

**SHIP-002: 운송장 번호 등록**
- 관리자가 배송 시작 시 운송장 번호 입력
- 운송장 번호 등록 시 자동으로 '배송중' 상태로 변경
- 고객에게 배송 시작 알림 발송 (선택사항)

---

### 4.7 사용자 관리

| 기능 ID | 기능명 | 설명 | 우선순위 | 담당 역할 |
|---------|--------|------|----------|-----------|
| USER-001 | 잔액 조회 | 사용자 예치금(잔액) 조회 | High | 고객 |
| USER-002 | 잔액 충전 | 사용자 예치금 충전 처리 | High | 고객 |
| USER-003 | 잔액 차감 | 결제 시 사용자 잔액 차감 | Critical | 시스템 |

#### 세부 요구사항

**USER-001: 잔액 조회**
- 현재 사용 가능한 잔액 조회
- 잔액 변동 이력 조회 (충전, 사용)

**USER-002: 잔액 충전**
- 충전 금액 입력 (최소 1,000원)
- 충전 방법 선택 (현재는 간단 충전으로 구현)
- 충전 완료 시 잔액 증가
- 충전 이력 기록

**USER-003: 잔액 차감**
- 결제 시 자동 차감
- 잔액 부족 시 차감 실패
- 트랜잭션 보장

---

## 5. 비기능 요구사항

### 5.1 성능 요구사항
- **응답 시간**:
  - 조회 API: 평균 200ms 이하
  - 주문/결제 API: 평균 1초 이하
- **처리량**:
  - 동시 접속자 1,000명 처리 가능
  - 선착순 쿠폰 발급 시 동시 요청 1,000건 처리 가능

### 5.2 동시성 제어
- **재고 차감**: 결제 시점에서 재고를 차감하는 상황에서 동시성 이슈 발생. docs/concurrency/inventory.md 설계 내용 참고
- **쿠폰 발급**: 선착순 쿠폰 발급 시 동시성 이슈 발생. docs/concurrency/coupon.md 설계 내용 참고 
- **잔액 차감**: 데이터베이스 트랜잭션 격리 수준 설정

### 5.3 모니터링 및 로깅
- 애플리케이션 로그 수집 및 분석
- 에러 추적 및 알림

---

## 6. 데이터 모델
- docs/ERD.md 참고

---

## 7. API 설계 원칙

### 7.1 RESTful API 설계
- HTTP 메서드 적절한 사용 (GET, POST, PUT, PATCH, DELETE)
- 계층적 URL 구조

### 7.2 응답 형식
- JSON 형식 사용
- 표준 HTTP 상태 코드 사용
- 에러 응답 형식 통일

---

## 8. 제약사항 및 가정

### 8.1 제약사항
- 결제는 잔액(예치금) 기반으로만 처리 (외부 PG 연동 없음)
- 배송 추적은 운송장 번호만 제공 (배송사 API 연동 없음)
- 1개의 주문에 1개의 쿠폰만 적용 가능
- 환불/취소 기능은 현재 버전에서 제외
- 사용자 인증/인가 기능 제외
- 상품 주문 시 배송지만 입력 가능하도록 제한
- 이력 기능은 현재 버전에서 제외
- 주문 예약 만료 상태 변경은 현재 버전에서 제외

### 8.2 가정
- 모든 사용자는 사전에 회원가입 및 로그인 완료된 상태
- 상품 옵션은 관리자가 사전에 등록한 상태
- 배송비는 무료 (별도 계산 없음)
- 재고는 0개까지 차감 가능 (음수 불가)

---

## 9. 우선순위 및 로드맵

### 9.1 Phase 1 (MVP)
- 상품 조회 (PROD-001, PROD-002, PROD-003)
- 재고 관리 (INV-001, INV-002, INV-003)
- 주문/결제 (ORD-001, ORD-003, ORD-004, ORD-005)
- 사용자 잔액 관리 (USER-001, USER-002, USER-003)

### 9.2 Phase 2
- 장바구니 (CART-001 ~ CART-004)
- 쿠폰 (CPN-001 ~ CPN-005)
- 주문 조회 (ORD-006, ORD-007, ORD-008)

### 9.3 Phase 3
- 배송 관리 (SHIP-001, SHIP-002)

---

## 10. 용어 정의

| 용어 | 정의 |
|------|------|
| 상품 옵션 | 동일 상품에 대한 변형 (분쇄도, 용량 등) |
| 재고 | 옵션별로 관리되는 수량 |
| 잔액 (예치금) | 사용자가 사전에 충전한 결제 수단 |
| 선착순 쿠폰 | 발급 수량이 제한되어 있으며, 선착순으로 발급되는 쿠폰 |
| 주문 상태 | 주문의 현재 단계 (결제완료, 상품준비중, 배송중, 배송완료) |
| 운송장 번호 | 배송사에서 제공하는 배송 추적 번호 |

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|-----|
| 1.0 | 2025-11-02 | 초안 작성 | 이태희 |
